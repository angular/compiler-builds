{"version":3,"sources":["../../../../../modules/@angular/compiler/src/i18n/translation_bundle.ts"],"names":[],"mappings":"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","file":"translation_bundle.js","sourceRoot":"","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {MissingTranslationStrategy} from '@angular/core';\n\nimport * as html from '../ml_parser/ast';\nimport {HtmlParser} from '../ml_parser/html_parser';\nimport {Console} from '../private_import_core';\n\nimport * as i18n from './i18n_ast';\nimport {I18nError} from './parse_util';\nimport {PlaceholderMapper, Serializer} from './serializers/serializer';\n/**\n * A container for translated messages\n */\nexport class TranslationBundle {\nprivate _i18nToHtml: I18nToHtmlVisitor;\n/**\n * @param {?=} _i18nNodesByMsgId\n * @param {?} locale\n * @param {?} digest\n * @param {?=} mapperFactory\n * @param {?=} missingTranslationStrategy\n * @param {?=} console\n */\nconstructor(\nprivate _i18nNodesByMsgId: {[msgId: string]: i18n.Node[]} = {}, locale: string|null,\npublic digest: (m: i18n.Message) => string,\npublic mapperFactory?: (m: i18n.Message) => PlaceholderMapper,\n      missingTranslationStrategy: MissingTranslationStrategy = MissingTranslationStrategy.Warning,\n      console?: Console) {\n    this._i18nToHtml = new I18nToHtmlVisitor(\n        _i18nNodesByMsgId, locale, digest, mapperFactory, missingTranslationStrategy, console);\n  }\n/**\n * @param {?} content\n * @param {?} url\n * @param {?} serializer\n * @param {?} missingTranslationStrategy\n * @param {?=} console\n * @return {?}\n */\nstatic load(\n      content: string, url: string, serializer: Serializer,\n      missingTranslationStrategy: MissingTranslationStrategy,\n      console?: Console): TranslationBundle {\n    const {locale, i18nNodesByMsgId} = serializer.load(content, url);\n    const /** @type {?} */ digestFn = (m: i18n.Message) => serializer.digest(m);\n    const /** @type {?} */ mapperFactory = (m: i18n.Message) => serializer.createNameMapper(m);\n    return new TranslationBundle(\n        i18nNodesByMsgId, locale, digestFn, mapperFactory, missingTranslationStrategy, console);\n  }\n/**\n * @param {?} srcMsg\n * @return {?}\n */\nget(srcMsg: i18n.Message): html.Node[] {\n    const /** @type {?} */ html = this._i18nToHtml.convert(srcMsg);\n\n    if (html.errors.length) {\n      throw new Error(html.errors.join('\\n'));\n    }\n\n    return html.nodes;\n  }\n/**\n * @param {?} srcMsg\n * @return {?}\n */\nhas(srcMsg: i18n.Message): boolean { return this.digest(srcMsg) in this._i18nNodesByMsgId; }\n}\n\nfunction TranslationBundle_tsickle_Closure_declarations() {\n/** @type {?} */\nTranslationBundle.prototype._i18nToHtml;\n/** @type {?} */\nTranslationBundle.prototype._i18nNodesByMsgId;\n/** @type {?} */\nTranslationBundle.prototype.digest;\n/** @type {?} */\nTranslationBundle.prototype.mapperFactory;\n}\n\nclass I18nToHtmlVisitor implements i18n.Visitor {\nprivate _srcMsg: i18n.Message;\nprivate _contextStack: {msg: i18n.Message, mapper: (name: string) => string}[] = [];\nprivate _errors: I18nError[] = [];\nprivate _mapper: (name: string) => string;\n/**\n * @param {?=} _i18nNodesByMsgId\n * @param {?} _locale\n * @param {?} _digest\n * @param {?} _mapperFactory\n * @param {?} _missingTranslationStrategy\n * @param {?=} _console\n */\nconstructor(\nprivate _i18nNodesByMsgId: {[msgId: string]: i18n.Node[]} = {},\nprivate _locale: string|null,\nprivate _digest: (m: i18n.Message) => string,\nprivate _mapperFactory: (m: i18n.Message) => PlaceholderMapper,\nprivate _missingTranslationStrategy: MissingTranslationStrategy,\nprivate _console?: Console) {\n  }\n/**\n * @param {?} srcMsg\n * @return {?}\n */\nconvert(srcMsg: i18n.Message): {nodes: html.Node[], errors: I18nError[]} {\n    this._contextStack.length = 0;\n    this._errors.length = 0;\n\n    // i18n to text\n    const /** @type {?} */ text = this._convertToText(srcMsg);\n\n    // text to html\n    const /** @type {?} */ url = srcMsg.nodes[0].sourceSpan.start.file.url;\n    const /** @type {?} */ html = new HtmlParser().parse(text, url, true);\n\n    return {\n      nodes: html.rootNodes,\n      errors: [...this._errors, ...html.errors],\n    };\n  }\n/**\n * @param {?} text\n * @param {?=} context\n * @return {?}\n */\nvisitText(text: i18n.Text, context?: any): string { return text.value; }\n/**\n * @param {?} container\n * @param {?=} context\n * @return {?}\n */\nvisitContainer(container: i18n.Container, context?: any): any {\n    return container.children.map(n => n.visit(this)).join('');\n  }\n/**\n * @param {?} icu\n * @param {?=} context\n * @return {?}\n */\nvisitIcu(icu: i18n.Icu, context?: any): any {\n    const /** @type {?} */ cases = Object.keys(icu.cases).map(k => `${k} {${icu.cases[k].visit(this)}}`);\n\n    // TODO(vicb): Once all format switch to using expression placeholders\n    // we should throw when the placeholder is not in the source message\n    const /** @type {?} */ exp = this._srcMsg.placeholders.hasOwnProperty(icu.expression) ?\n        this._srcMsg.placeholders[icu.expression] :\n        icu.expression;\n\n    return `{${exp}, ${icu.type}, ${cases.join(' ')}}`;\n  }\n/**\n * @param {?} ph\n * @param {?=} context\n * @return {?}\n */\nvisitPlaceholder(ph: i18n.Placeholder, context?: any): string {\n    const /** @type {?} */ phName = this._mapper(ph.name);\n    if (this._srcMsg.placeholders.hasOwnProperty(phName)) {\n      return this._srcMsg.placeholders[phName];\n    }\n\n    if (this._srcMsg.placeholderToMessage.hasOwnProperty(phName)) {\n      return this._convertToText(this._srcMsg.placeholderToMessage[phName]);\n    }\n\n    this._addError(ph, `Unknown placeholder \"${ph.name}\"`);\n    return '';\n  }\n/**\n * @param {?} ph\n * @param {?=} context\n * @return {?}\n */\nvisitTagPlaceholder(ph: i18n.TagPlaceholder, context?: any): string {\n    const /** @type {?} */ tag = `${ph.tag}`;\n    const /** @type {?} */ attrs = Object.keys(ph.attrs).map(name => `${name}=\"${ph.attrs[name]}\"`).join(' ');\n    if (ph.isVoid) {\n      return `<${tag} ${attrs}/>`;\n    }\n    const /** @type {?} */ children = ph.children.map((c: i18n.Node) => c.visit(this)).join('');\n    return `<${tag} ${attrs}>${children}</${tag}>`;\n  }\n/**\n * @param {?} ph\n * @param {?=} context\n * @return {?}\n */\nvisitIcuPlaceholder(ph: i18n.IcuPlaceholder, context?: any): string {\n    // An ICU placeholder references the source message to be serialized\n    return this._convertToText(this._srcMsg.placeholderToMessage[ph.name]);\n  }\n/**\n * Convert a source message to a translated text string:\n * - text nodes are replaced with their translation,\n * - placeholders are replaced with their content,\n * - ICU nodes are converted to ICU expressions.\n * @param {?} srcMsg\n * @return {?}\n */\nprivate _convertToText(srcMsg: i18n.Message): string {\n    const /** @type {?} */ id = this._digest(srcMsg);\n    const /** @type {?} */ mapper = this._mapperFactory ? this._mapperFactory(srcMsg) : null;\n    let /** @type {?} */ nodes: i18n.Node[];\n\n    this._contextStack.push({msg: this._srcMsg, mapper: this._mapper});\n    this._srcMsg = srcMsg;\n\n    if (this._i18nNodesByMsgId.hasOwnProperty(id)) {\n      // When there is a translation use its nodes as the source\n      // And create a mapper to convert serialized placeholder names to internal names\n      nodes = this._i18nNodesByMsgId[id];\n      this._mapper = (name: string) => mapper ? mapper.toInternalName(name) : name;\n    } else {\n      // When no translation has been found\n      // - report an error / a warning / nothing,\n      // - use the nodes from the original message\n      // - placeholders are already internal and need no mapper\n      if (this._missingTranslationStrategy === MissingTranslationStrategy.Error) {\n        const /** @type {?} */ ctx = this._locale ? ` for locale \"${this._locale}\"` : '';\n        this._addError(srcMsg.nodes[0], `Missing translation for message \"${id}\"${ctx}`);\n      } else if (\n          this._console &&\n          this._missingTranslationStrategy === MissingTranslationStrategy.Warning) {\n        const /** @type {?} */ ctx = this._locale ? ` for locale \"${this._locale}\"` : '';\n        this._console.warn(`Missing translation for message \"${id}\"${ctx}`);\n      }\n      nodes = srcMsg.nodes;\n      this._mapper = (name: string) => name;\n    }\n    const /** @type {?} */ text = nodes.map(node => node.visit(this)).join('');\n    const /** @type {?} */ context = this._contextStack.pop();\n    this._srcMsg = context.msg;\n    this._mapper = context.mapper;\n    return text;\n  }\n/**\n * @param {?} el\n * @param {?} msg\n * @return {?}\n */\nprivate _addError(el: i18n.Node, msg: string) {\n    this._errors.push(new I18nError(el.sourceSpan, msg));\n  }\n}\n\nfunction I18nToHtmlVisitor_tsickle_Closure_declarations() {\n/** @type {?} */\nI18nToHtmlVisitor.prototype._srcMsg;\n/** @type {?} */\nI18nToHtmlVisitor.prototype._contextStack;\n/** @type {?} */\nI18nToHtmlVisitor.prototype._errors;\n/** @type {?} */\nI18nToHtmlVisitor.prototype._mapper;\n/** @type {?} */\nI18nToHtmlVisitor.prototype._i18nNodesByMsgId;\n/** @type {?} */\nI18nToHtmlVisitor.prototype._locale;\n/** @type {?} */\nI18nToHtmlVisitor.prototype._digest;\n/** @type {?} */\nI18nToHtmlVisitor.prototype._mapperFactory;\n/** @type {?} */\nI18nToHtmlVisitor.prototype._missingTranslationStrategy;\n/** @type {?} */\nI18nToHtmlVisitor.prototype._console;\n}\n\n"]}